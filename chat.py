import time
from brain import MemoryDB, Avatar, Gateway, SILENT_MODE

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∞, –ø–∞–º—è—Ç–∏ –∏ —à–ª—é–∑–∞
try:
    avatar = Avatar()
    memory = MemoryDB(debug=True)
    gateway = Gateway(memory_db=memory, avatar=avatar)
    print("üß† –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.")
except Exception as e:
    print(f"[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {e}")
    exit()

# –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º
time.sleep(1.5)

def check_system():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ"""
    try:
        print("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ...")
        print(f"–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: SILENT_MODE = {SILENT_MODE}")
        print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–π—Ä–æ–Ω–æ–≤: {len(memory.neurons)}")
        print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π: {len(memory.associations)}")
    except Exception as e:
        print(f"[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–∏—Å—Ç–µ–º—ã: {e}")
        exit()

check_system()

def run_chat():
    """–ó–∞–ø—É—Å–∫ —á–∞—Ç-—Å–µ—Å—Å–∏–∏"""
    try:
        print("üîÆ –ñ–∏–≤–æ–µ —Å—É—â–µ—Å—Ç–≤–æ –∂–¥—ë—Ç —Ç–≤–æ–π —Å–∏–≥–Ω–∞–ª. –ù–∞–ø–∏—à–∏ 'exit' —á—Ç–æ–±—ã –≤—ã–π—Ç–∏.\n")

        while True:
            # –û–∂–∏–¥–∞–µ–º –ø–µ—Ä–≤—ã–π —Å–∏–≥–Ω–∞–ª –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            text = input("üë§ –¢—ã: ").strip()

            if text.lower() in ("exit", "quit"):
                print("üëã –î–æ –≤—Å—Ç—Ä–µ—á–∏.")
                break

            # –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            print(f"[CHAT] –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª: {text}")

            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–≥–Ω–∞–ª –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
            response = gateway.receive(text)

            # –ü–µ—á–∞—Ç–∞–µ–º –æ—Ç–≤–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å
            print(f"üß† –û—Ç–≤–µ—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã: {response}")

            # –ü–∞—É–∑–∞, —á—Ç–æ–±—ã –¥–∞—Ç—å —Å–∏—Å—Ç–µ–º–µ –≤—Ä–µ–º—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            time.sleep(1.5)

    except KeyboardInterrupt:
        print("\nüõë –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
        exit()
    except Exception as e:
        print(f"[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–∏–≥–Ω–∞–ª–∞: {e}")
        print(f"[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–∏–≥–Ω–∞–ª–∞: {e}")  # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É

if __name__ == "__main__":
    try:
        print("üîÆ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≥–æ—Ç–æ–≤–∞ –æ–∂–∏–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞.")
        run_chat()
    except Exception as e:
        print(f"[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–∞—Ç–∞: {e}")
